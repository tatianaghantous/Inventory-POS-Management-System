using System.Security.Cryptography;
using System.Text;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using ShopifyAPI.Controllers;
using ShopifyAPI.Models;
using ShopifyAPI.Services;
using Xunit;

namespace UnitTests
{

    public class UnitTest1
    {

        [Fact]
        public void HandlePostRequest_ReturnsOkResult_WhenVerificationSucceeds()
        {
            // Arrange
            // Instantiate your ClothingStoreContext
            // Instantiate your InventoryService
            var context = new ClothingStoreContext();
            var inventoryService = new InventoryService(context);
            var webhookAuthenticationService = new WebhookAuthenticationService(); // Instantiate your WebhookAuthenticationService

            var controller = new InventoriesController(context, inventoryService, webhookAuthenticationService);;
            string requestBodyyy = "{\"method\":\"POST\",\"body\":{\"id\":5624583291011,\"admin_graphql_api_id\":\"gid://shopify/Order/5624583291011\",\"app_id\":580111,\"browser_ip\":\"94.187.8.200\",\"buyer_accepts_marketing\":false,\"cancel_reason\":null,\"cancelled_at\":null,\"cart_token\":\"Z2NwLXVzLWNlbnRyYWwxOjAxSFNEUjU0MTlXVEZRREZOS0RHVkY5SldU\",\"checkout_id\":42942518984835,\"checkout_token\":\"507675b88e2bc5e1df1fc5d6d42e5ac3\",\"client_details\":{\"accept_language\":\"en-LB\",\"browser_height\":null,\"browser_ip\":\"94.187.8.200\",\"browser_width\":null,\"session_hash\":null,\"user_agent\":\"Mozilla/5.0 (iPhone; CPU iPhone OS 17_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.3.1 Mobile/15E148 Safari/604.1\"},\"closed_at\":null,\"confirmation_number\":\"2GTFILMX7\",\"confirmed\":true,\"contact_email\":\"tatianaghantous2@gmail.com\",\"created_at\":\"2024-03-20T12:58:23+02:00\",\"currency\":\"USD\",\"current_subtotal_price\":\"91.38\",\"current_subtotal_price_set\":{\"shop_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"}},\"current_total_additional_fees_set\":null,\"current_total_discounts\":\"0.00\",\"current_total_discounts_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"current_total_duties_set\":null,\"current_total_price\":\"100.52\",\"current_total_price_set\":{\"shop_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"}},\"current_total_tax\":\"9.14\",\"current_total_tax_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"customer_locale\":\"en-LB\",\"device_id\":null,\"discount_codes\":[],\"email\":\"tatianaghantous2@gmail.com\",\"estimated_taxes\":false,\"financial_status\":\"pending\",\"fulfillment_status\":null,\"landing_site\":\"/\",\"landing_site_ref\":null,\"location_id\":null,\"merchant_of_record_app_id\":null,\"name\":\"#1001003\",\"note\":null,\"note_attributes\":[],\"number\":3,\"order_number\":1003,\"order_status_url\":\"https://e90236-f9.myshopify.com/58751844483/orders/aacfc14a0e97a80a5c9175cf05747252/authenticate?key=6759906a00cf64798bb79d197d6c6c8d\",\"original_total_additional_fees_set\":null,\"original_total_duties_set\":null,\"payment_gateway_names\":[\"Cash on Delivery (COD)\"],\"phone\":null,\"po_number\":null,\"presentment_currency\":\"USD\",\"processed_at\":\"2024-03-20T12:58:21+02:00\",\"reference\":\"2e0d4d1f821e399b9272dd556e7d5d78\",\"referring_site\":\"\",\"source_identifier\":\"2e0d4d1f821e399b9272dd556e7d5d78\",\"source_name\":\"web\",\"source_url\":null,\"subtotal_price\":\"91.38\",\"subtotal_price_set\":{\"shop_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"}},\"tags\":\"\",\"tax_exempt\":false,\"tax_lines\":[{\"price\":\"9.14\",\"rate\":0.1,\"title\":\"VAT\",\"price_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"channel_liable\":false}],\"taxes_included\":false,\"test\":false,\"token\":\"aacfc14a0e97a80a5c9175cf05747252\",\"total_discounts\":\"0.00\",\"total_discounts_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"total_line_items_price\":\"91.38\",\"total_line_items_price_set\":{\"shop_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"}},\"total_outstanding\":\"100.52\",\"total_price\":\"100.52\",\"total_price_set\":{\"shop_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"}},\"total_shipping_price_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"total_tax\":\"9.14\",\"total_tax_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"total_tip_received\":\"0.00\",\"total_weight\":400,\"updated_at\":\"2024-03-20T12:58:24+02:00\",\"user_id\":null,\"billing_address\":{\"first_name\":\"Tatiana\",\"address1\":\"Roumiehb\",\"phone\":null,\"city\":\"Beirut\",\"zip\":null,\"province\":null,\"country\":\"Lebanon\",\"last_name\":\"Ghantous\",\"address2\":null,\"company\":null,\"latitude\":null,\"longitude\":null,\"name\":\"Tatiana Ghantous\",\"country_code\":\"LB\",\"province_code\":null},\"customer\":{\"id\":6970289356931,\"email\":\"tatianaghantous2@gmail.com\",\"created_at\":\"2024-03-20T12:45:10+02:00\",\"updated_at\":\"2024-03-20T12:58:23+02:00\",\"first_name\":\"Tatiana\",\"last_name\":\"Ghantous\",\"state\":\"disabled\",\"note\":null,\"verified_email\":true,\"multipass_identifier\":null,\"tax_exempt\":false,\"phone\":null,\"email_marketing_consent\":{\"state\":\"not_subscribed\",\"opt_in_level\":\"single_opt_in\",\"consent_updated_at\":null},\"sms_marketing_consent\":null,\"tags\":\"\",\"currency\":\"USD\",\"tax_exemptions\":[],\"admin_graphql_api_id\":\"gid://shopify/Customer/6970289356931\",\"default_address\":{\"id\":8823274799235,\"customer_id\":6970289356931,\"first_name\":\"Tatiana\",\"last_name\":\"Ghantous\",\"company\":null,\"address1\":\"Roumiehb\",\"address2\":null,\"city\":\"Beirut\",\"province\":null,\"country\":\"Lebanon\",\"zip\":null,\"phone\":null,\"name\":\"Tatiana Ghantous\",\"province_code\":null,\"country_code\":\"LB\",\"country_name\":\"Lebanon\",\"default\":true}},\"discount_applications\":[],\"fulfillments\":[],\"line_items\":[{\"id\":13364643659907,\"admin_graphql_api_id\":\"gid://shopify/LineItem/13364643659907\",\"attributed_staffs\":[],\"current_quantity\":2,\"fulfillable_quantity\":2,\"fulfillment_service\":\"manual\",\"fulfillment_status\":null,\"gift_card\":false,\"grams\":200,\"name\":\"Mediastar Receiver - black / 32\",\"price\":\"45.69\",\"price_set\":{\"shop_money\":{\"amount\":\"45.69\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"45.69\",\"currency_code\":\"USD\"}},\"product_exists\":true,\"product_id\":8087641653379,\"properties\":[],\"quantity\":2,\"requires_shipping\":true,\"sku\":\"sdgdgfFF-1\",\"taxable\":true,\"title\":\"Mediastar Receiver\",\"total_discount\":\"0.00\",\"total_discount_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"variant_id\":43802780336259,\"variant_inventory_management\":\"shopify\",\"variant_title\":\"black / 32\",\"vendor\":\"Galaxy Sat\",\"tax_lines\":[{\"channel_liable\":false,\"price\":\"9.14\",\"price_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"rate\":0.1,\"title\":\"VAT\"}],\"duties\":[],\"discount_allocations\":[]}],\"payment_terms\":null,\"refunds\":[],\"shipping_address\":{\"first_name\":\"Tatiana\",\"address1\":\"Roumiehb\",\"phone\":null,\"city\":\"Beirut\",\"zip\":null,\"province\":null,\"country\":\"Lebanon\",\"last_name\":\"Ghantous\",\"address2\":null,\"company\":null,\"latitude\":33.8937913,\"longitude\":35.5017767,\"name\":\"Tatiana Ghantous\",\"country_code\":\"LB\",\"province_code\":null},\"shipping_lines\":[{\"id\":4418002485379,\"carrier_identifier\":\"650f1a14fa979ec5c74d063e968411d4\",\"code\":\"Standard\",\"discounted_price\":\"0.00\",\"discounted_price_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"phone\":null,\"price\":\"0.00\",\"price_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"requested_fulfillment_service_id\":null,\"source\":\"shopify\",\"title\":\"Standard\",\"tax_lines\":[],\"discount_allocations\":[]}]}}";
            string requestBodyy = "{\"id\":5624583291011,\"admin_graphql_api_id\":\"gid://shopify/Order/5624583291011\",\"app_id\":580111,\"browser_ip\":\"94.187.8.200\",\"buyer_accepts_marketing\":false,\"cancel_reason\":null,\"cancelled_at\":null,\"cart_token\":\"Z2NwLXVzLWNlbnRyYWwxOjAxSFNEUjU0MTlXVEZRREZOS0RHVkY5SldU\",\"checkout_id\":42942518984835,\"checkout_token\":\"507675b88e2bc5e1df1fc5d6d42e5ac3\",\"client_details\":{\"accept_language\":\"en-LB\",\"browser_height\":null,\"browser_ip\":\"94.187.8.200\",\"browser_width\":null,\"session_hash\":null,\"user_agent\":\"Mozilla/5.0 (iPhone; CPU iPhone OS 17_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.3.1 Mobile/15E148 Safari/604.1\"},\"closed_at\":null,\"confirmation_number\":\"2GTFILMX7\",\"confirmed\":true,\"contact_email\":\"tatianaghantous2@gmail.com\",\"created_at\":\"2024-03-20T12:58:23+02:00\",\"currency\":\"USD\",\"current_subtotal_price\":\"91.38\",\"current_subtotal_price_set\":{\"shop_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"}},\"current_total_additional_fees_set\":null,\"current_total_discounts\":\"0.00\",\"current_total_discounts_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"current_total_duties_set\":null,\"current_total_price\":\"100.52\",\"current_total_price_set\":{\"shop_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"}},\"current_total_tax\":\"9.14\",\"current_total_tax_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"customer_locale\":\"en-LB\",\"device_id\":null,\"discount_codes\":[],\"email\":\"tatianaghantous2@gmail.com\",\"estimated_taxes\":false,\"financial_status\":\"pending\",\"fulfillment_status\":null,\"landing_site\":\"/\",\"landing_site_ref\":null,\"location_id\":null,\"merchant_of_record_app_id\":null,\"name\":\"#1001003\",\"note\":null,\"note_attributes\":[],\"number\":3,\"order_number\":1003,\"order_status_url\":\"https://e90236-f9.myshopify.com/58751844483/orders/aacfc14a0e97a80a5c9175cf05747252/authenticate?key=6759906a00cf64798bb79d197d6c6c8d\",\"original_total_additional_fees_set\":null,\"original_total_duties_set\":null,\"payment_gateway_names\":[\"Cash on Delivery (COD)\"],\"phone\":null,\"po_number\":null,\"presentment_currency\":\"USD\",\"processed_at\":\"2024-03-20T12:58:21+02:00\",\"reference\":\"2e0d4d1f821e399b9272dd556e7d5d78\",\"referring_site\":\"\",\"source_identifier\":\"2e0d4d1f821e399b9272dd556e7d5d78\",\"source_name\":\"web\",\"source_url\":null,\"subtotal_price\":\"91.38\",\"subtotal_price_set\":{\"shop_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"}},\"tags\":\"\",\"tax_exempt\":false,\"tax_lines\":[{\"price\":\"9.14\",\"rate\":0.1,\"title\":\"VAT\",\"price_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"channel_liable\":false}],\"taxes_included\":false,\"test\":false,\"token\":\"aacfc14a0e97a80a5c9175cf05747252\",\"total_discounts\":\"0.00\",\"total_discounts_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"total_line_items_price\":\"91.38\",\"total_line_items_price_set\":{\"shop_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"}},\"total_outstanding\":\"100.52\",\"total_price\":\"100.52\",\"total_price_set\":{\"shop_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"}},\"total_shipping_price_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"total_tax\":\"9.14\",\"total_tax_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"total_tip_received\":\"0.00\",\"total_weight\":400,\"updated_at\":\"2024-03-20T12:58:24+02:00\",\"user_id\":null,\"billing_address\":{\"first_name\":\"Tatiana\",\"address1\":\"Roumiehb\",\"phone\":null,\"city\":\"Beirut\",\"zip\":null,\"province\":null,\"country\":\"Lebanon\",\"last_name\":\"Ghantous\",\"address2\":null,\"company\":null,\"latitude\":null,\"longitude\":null,\"name\":\"Tatiana Ghantous\",\"country_code\":\"LB\",\"province_code\":null},\"customer\":{\"id\":6970289356931,\"email\":\"tatianaghantous2@gmail.com\",\"created_at\":\"2024-03-20T12:45:10+02:00\",\"updated_at\":\"2024-03-20T12:58:23+02:00\",\"first_name\":\"Tatiana\",\"last_name\":\"Ghantous\",\"state\":\"disabled\",\"note\":null,\"verified_email\":true,\"multipass_identifier\":null,\"tax_exempt\":false,\"phone\":null,\"email_marketing_consent\":{\"state\":\"not_subscribed\",\"opt_in_level\":\"single_opt_in\",\"consent_updated_at\":null},\"sms_marketing_consent\":null,\"tags\":\"\",\"currency\":\"USD\",\"tax_exemptions\":[],\"admin_graphql_api_id\":\"gid://shopify/Customer/6970289356931\",\"default_address\":{\"id\":8823274799235,\"customer_id\":6970289356931,\"first_name\":\"Tatiana\",\"last_name\":\"Ghantous\",\"company\":null,\"address1\":\"Roumiehb\",\"address2\":null,\"city\":\"Beirut\",\"province\":null,\"country\":\"Lebanon\",\"zip\":null,\"phone\":null,\"name\":\"Tatiana Ghantous\",\"province_code\":null,\"country_code\":\"LB\",\"country_name\":\"Lebanon\",\"default\":true}},\"discount_applications\":[],\"fulfillments\":[],\"line_items\":[{\"id\":13364643659907,\"admin_graphql_api_id\":\"gid://shopify/LineItem/13364643659907\",\"attributed_staffs\":[],\"current_quantity\":2,\"fulfillable_quantity\":2,\"fulfillment_service\":\"manual\",\"fulfillment_status\":null,\"gift_card\":false,\"grams\":200,\"name\":\"Mediastar Receiver - black / 32\",\"price\":\"45.69\",\"price_set\":{\"shop_money\":{\"amount\":\"45.69\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"45.69\",\"currency_code\":\"USD\"}},\"product_exists\":true,\"product_id\":8087641653379,\"properties\":[],\"quantity\":2,\"requires_shipping\":true,\"sku\":\"sdgdgfFF-1\",\"taxable\":true,\"title\":\"Mediastar Receiver\",\"total_discount\":\"0.00\",\"total_discount_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"variant_id\":43802780336259,\"variant_inventory_management\":\"shopify\",\"variant_title\":\"black / 32\",\"vendor\":\"Galaxy Sat\",\"tax_lines\":[{\"channel_liable\":false,\"price\":\"9.14\",\"price_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"rate\":0.1,\"title\":\"VAT\"}],\"duties\":[],\"discount_allocations\":[]}],\"payment_terms\":null,\"refunds\":[],\"shipping_address\":{\"first_name\":\"Tatiana\",\"address1\":\"Roumiehb\",\"phone\":null,\"city\":\"Beirut\",\"zip\":null,\"province\":null,\"country\":\"Lebanon\",\"last_name\":\"Ghantous\",\"address2\":null,\"company\":null,\"latitude\":33.8937913,\"longitude\":35.5017767,\"name\":\"Tatiana Ghantous\",\"country_code\":\"LB\",\"province_code\":null},\"shipping_lines\":[{\"id\":4418002485379,\"carrier_identifier\":\"650f1a14fa979ec5c74d063e968411d4\",\"code\":\"Standard\",\"discounted_price\":\"0.00\",\"discounted_price_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"phone\":null,\"price\":\"0.00\",\"price_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"requested_fulfillment_service_id\":null,\"source\":\"shopify\",\"title\":\"Standard\",\"tax_lines\":[],\"discount_allocations\":[]}]}";
            string requestBody = "{\"id\":5624583291011,\"admin_graphql_api_id\":\"gid://shopify/Order/5624583291011\",\"app_id\":580111,\"browser_ip\":\"94.187.8.200\",\"buyer_accepts_marketing\":false,\"cancel_reason\":null,\"cancelled_at\":null,\"cart_token\":\"Z2NwLXVzLWNlbnRyYWwxOjAxSFNEUjU0MTlXVEZRREZOS0RHVkY5SldU\",\"checkout_id\":42942518984835,\"checkout_token\":\"507675b88e2bc5e1df1fc5d6d42e5ac3\",\"client_details\":{\"accept_language\":\"en-LB\",\"browser_height\":null,\"browser_ip\":\"94.187.8.200\",\"browser_width\":null,\"session_hash\":null,\"user_agent\":\"Mozilla/5.0 (iPhone; CPU iPhone OS 17_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.3.1 Mobile/15E148 Safari/604.1\"},\"closed_at\":null,\"confirmation_number\":\"2GTFILMX7\",\"confirmed\":true,\"contact_email\":\"tatianaghantous2@gmail.com\",\"created_at\":\"2024-03-20T12:58:23+02:00\",\"currency\":\"USD\",\"current_subtotal_price\":\"91.38\",\"current_subtotal_price_set\":{\"shop_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"}},\"current_total_additional_fees_set\":null,\"current_total_discounts\":\"0.00\",\"current_total_discounts_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"current_total_duties_set\":null,\"current_total_price\":\"100.52\",\"current_total_price_set\":{\"shop_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"}},\"current_total_tax\":\"9.14\",\"current_total_tax_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"customer_locale\":\"en-LB\",\"device_id\":null,\"discount_codes\":[],\"email\":\"tatianaghantous2@gmail.com\",\"estimated_taxes\":false,\"financial_status\":\"pending\",\"fulfillment_status\":null,\"landing_site\":\"/\",\"landing_site_ref\":null,\"location_id\":null,\"merchant_of_record_app_id\":null,\"name\":\"#1001003\",\"note\":null,\"note_attributes\":[],\"number\":3,\"order_number\":1003,\"order_status_url\":\"https://e90236-f9.myshopify.com/58751844483/orders/aacfc14a0e97a80a5c9175cf05747252/authenticate?key=6759906a00cf64798bb79d197d6c6c8d\",\"original_total_additional_fees_set\":null,\"original_total_duties_set\":null,\"payment_gateway_names\":[\"Cash on Delivery (COD)\"],\"phone\":null,\"po_number\":null,\"presentment_currency\":\"USD\",\"processed_at\":\"2024-03-20T12:58:21+02:00\",\"reference\":\"2e0d4d1f821e399b9272dd556e7d5d78\",\"referring_site\":\"\",\"source_identifier\":\"2e0d4d1f821e399b9272dd556e7d5d78\",\"source_name\":\"web\",\"source_url\":null,\"subtotal_price\":\"91.38\",\"subtotal_price_set\":{\"shop_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"}},\"tags\":\"\",\"tax_exempt\":false,\"tax_lines\":[{\"price\":\"9.14\",\"rate\":0.1,\"title\":\"VAT\",\"price_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"channel_liable\":false}],\"taxes_included\":false,\"test\":false,\"token\":\"aacfc14a0e97a80a5c9175cf05747252\",\"total_discounts\":\"0.00\",\"total_discounts_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"total_line_items_price\":\"91.38\",\"total_line_items_price_set\":{\"shop_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"}},\"total_outstanding\":\"100.52\",\"total_price\":\"100.52\",\"total_price_set\":{\"shop_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"}},\"total_shipping_price_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"total_tax\":\"9.14\",\"total_tax_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"total_tip_received\":\"0.00\",\"total_weight\":400,\"updated_at\":\"2024-03-20T12:58:24+02:00\",\"user_id\":null,\"billing_address\":{\"first_name\":\"Tatiana\",\"address1\":\"Roumiehb\",\"phone\":null,\"city\":\"Beirut\",\"zip\":null,\"province\":null,\"country\":\"Lebanon\",\"last_name\":\"Ghantous\",\"address2\":null,\"company\":null,\"latitude\":null,\"longitude\":null,\"name\":\"Tatiana Ghantous\",\"country_code\":\"LB\",\"province_code\":null},\"customer\":{\"id\":6970289356931,\"email\":\"tatianaghantous2@gmail.com\",\"created_at\":\"2024-03-20T12:45:10+02:00\",\"updated_at\":\"2024-03-20T12:58:23+02:00\",\"first_name\":\"Tatiana\",\"last_name\":\"Ghantous\",\"state\":\"disabled\",\"note\":null,\"verified_email\":true,\"multipass_identifier\":null,\"tax_exempt\":false,\"phone\":null,\"email_marketing_consent\":{\"state\":\"not_subscribed\",\"opt_in_level\":\"single_opt_in\",\"consent_updated_at\":null},\"sms_marketing_consent\":null,\"tags\":\"\",\"currency\":\"USD\",\"tax_exemptions\":[],\"admin_graphql_api_id\":\"gid://shopify/Customer/6970289356931\",\"default_address\":{\"id\":8823274799235,\"customer_id\":6970289356931,\"first_name\":\"Tatiana\",\"last_name\":\"Ghantous\",\"company\":null,\"address1\":\"Roumiehb\",\"address2\":null,\"city\":\"Beirut\",\"province\":null,\"country\":\"Lebanon\",\"zip\":null,\"phone\":null,\"name\":\"Tatiana Ghantous\",\"province_code\":null,\"country_code\":\"LB\",\"country_name\":\"Lebanon\",\"default\":true}},\"discount_applications\":[],\"fulfillments\":[],\"line_items\":[{\"id\":13364643659907,\"admin_graphql_api_id\":\"gid://shopify/LineItem/13364643659907\",\"attributed_staffs\":[],\"current_quantity\":2,\"fulfillable_quantity\":2,\"fulfillment_service\":\"manual\",\"fulfillment_status\":null,\"gift_card\":false,\"grams\":200,\"name\":\"Mediastar Receiver - black / 32\",\"price\":\"45.69\",\"price_set\":{\"shop_money\":{\"amount\":\"45.69\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"45.69\",\"currency_code\":\"USD\"}},\"product_exists\":true,\"product_id\":8087641653379,\"properties\":[],\"quantity\":2,\"requires_shipping\":true,\"sku\":\"sdgdgfFF-1\",\"taxable\":true,\"title\":\"Mediastar Receiver\",\"total_discount\":\"0.00\",\"total_discount_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"variant_id\":43802780336259,\"variant_inventory_management\":\"shopify\",\"variant_title\":\"black / 32\",\"vendor\":\"Galaxy Sat\",\"tax_lines\":[{\"channel_liable\":false,\"price\":\"9.14\",\"price_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"rate\":0.1,\"title\":\"VAT\"}],\"duties\":[],\"discount_allocations\":[]}],\"payment_terms\":null,\"refunds\":[],\"shipping_address\":{\"first_name\":\"Tatiana\",\"address1\":\"Roumiehb\",\"phone\":null,\"city\":\"Beirut\",\"zip\":null,\"province\":null,\"country\":\"Lebanon\",\"last_name\":\"Ghantous\",\"address2\":null,\"company\":null,\"latitude\":33.8937913,\"longitude\":35.5017767,\"name\":\"Tatiana Ghantous\",\"country_code\":\"LB\",\"province_code\":null},\"shipping_lines\":[{\"id\":4418002485379,\"carrier_identifier\":\"650f1a14fa979ec5c74d063e968411d4\",\"code\":\"Standard\",\"discounted_price\":\"0.00\",\"discounted_price_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"phone\":null,\"price\":\"0.00\",\"price_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"requested_fulfillment_service_id\":null,\"source\":\"shopify\",\"title\":\"Standard\",\"tax_lines\":[],\"discount_allocations\":[]}]}";
            string hmacSignature = "J06+7uQkUshK0oz4ssqrRl/1zO11dcmn/Tp6cgbi8/c=";
            string a = "{\"method\":\"POST\",\"path\":\"/\",\"query\":{},\"client_ip\":\"34.136.3.6\",\"url\":\"https://eoz5czz3aoctv7h.m.pipedream.net/\",\"headers\":{\"host\":\"eoz5czz3aoctv7h.m.pipedream.net\",\"content-length\":\"7183\",\"user-agent\":\"Shopify-Captain-Hook\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip;q=1.0,deflate;q=0.6,identity;q=0.3\",\"content-type\":\"application/json\",\"x-shopify-api-version\":\"2024-01\",\"x-shopify-hmac-sha256\":\"J06+7uQkUshK0oz4ssqrRl/1zO11dcmn/Tp6cgbi8/c=\",\"x-shopify-order-id\":\"5624583291011\",\"x-shopify-shop-domain\":\"e90236-f9.myshopify.com\",\"x-shopify-test\":\"false\",\"x-shopify-topic\":\"orders/create\",\"x-shopify-triggered-at\":\"2024-03-20T10:58:24.644195226Z\",\"x-shopify-webhook-id\":\"356f3d25-ddfa-4d6f-819b-c141e5a8cf6d\"},\"body\":{\"id\":5624583291011,\"admin_graphql_api_id\":\"gid://shopify/Order/5624583291011\",\"app_id\":580111,\"browser_ip\":\"94.187.8.200\",\"buyer_accepts_marketing\":false,\"cancel_reason\":null,\"cancelled_at\":null,\"cart_token\":\"Z2NwLXVzLWNlbnRyYWwxOjAxSFNEUjU0MTlXVEZRREZOS0RHVkY5SldU\",\"checkout_id\":42942518984835,\"checkout_token\":\"507675b88e2bc5e1df1fc5d6d42e5ac3\",\"client_details\":{\"accept_language\":\"en-LB\",\"browser_height\":null,\"browser_ip\":\"94.187.8.200\",\"browser_width\":null,\"session_hash\":null,\"user_agent\":\"Mozilla/5.0 (iPhone; CPU iPhone OS 17_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.3.1 Mobile/15E148 Safari/604.1\"},\"closed_at\":null,\"confirmation_number\":\"2GTFILMX7\",\"confirmed\":true,\"contact_email\":\"tatianaghantous2@gmail.com\",\"created_at\":\"2024-03-20T12:58:23+02:00\",\"currency\":\"USD\",\"current_subtotal_price\":\"91.38\",\"current_subtotal_price_set\":{\"shop_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"}},\"current_total_additional_fees_set\":null,\"current_total_discounts\":\"0.00\",\"current_total_discounts_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"current_total_duties_set\":null,\"current_total_price\":\"100.52\",\"current_total_price_set\":{\"shop_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"}},\"current_total_tax\":\"9.14\",\"current_total_tax_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"customer_locale\":\"en-LB\",\"device_id\":null,\"discount_codes\":[],\"email\":\"tatianaghantous2@gmail.com\",\"estimated_taxes\":false,\"financial_status\":\"pending\",\"fulfillment_status\":null,\"landing_site\":\"/\",\"landing_site_ref\":null,\"location_id\":null,\"merchant_of_record_app_id\":null,\"name\":\"#1001003\",\"note\":null,\"note_attributes\":[],\"number\":3,\"order_number\":1003,\"order_status_url\":\"https://e90236-f9.myshopify.com/58751844483/orders/aacfc14a0e97a80a5c9175cf05747252/authenticate?key=6759906a00cf64798bb79d197d6c6c8d\",\"original_total_additional_fees_set\":null,\"original_total_duties_set\":null,\"payment_gateway_names\":[\"Cash on Delivery (COD)\"],\"phone\":null,\"po_number\":null,\"presentment_currency\":\"USD\",\"processed_at\":\"2024-03-20T12:58:21+02:00\",\"reference\":\"2e0d4d1f821e399b9272dd556e7d5d78\",\"referring_site\":\"\",\"source_identifier\":\"2e0d4d1f821e399b9272dd556e7d5d78\",\"source_name\":\"web\",\"source_url\":null,\"subtotal_price\":\"91.38\",\"subtotal_price_set\":{\"shop_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"}},\"tags\":\"\",\"tax_exempt\":false,\"tax_lines\":[{\"price\":\"9.14\",\"rate\":0.1,\"title\":\"VAT\",\"price_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"channel_liable\":false}],\"taxes_included\":false,\"test\":false,\"token\":\"aacfc14a0e97a80a5c9175cf05747252\",\"total_discounts\":\"0.00\",\"total_discounts_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"total_line_items_price\":\"91.38\",\"total_line_items_price_set\":{\"shop_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"91.38\",\"currency_code\":\"USD\"}},\"total_outstanding\":\"100.52\",\"total_price\":\"100.52\",\"total_price_set\":{\"shop_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"100.52\",\"currency_code\":\"USD\"}},\"total_shipping_price_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"total_tax\":\"9.14\",\"total_tax_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"total_tip_received\":\"0.00\",\"total_weight\":400,\"updated_at\":\"2024-03-20T12:58:24+02:00\",\"user_id\":null,\"billing_address\":{\"first_name\":\"Tatiana\",\"address1\":\"Roumiehb\",\"phone\":null,\"city\":\"Beirut\",\"zip\":null,\"province\":null,\"country\":\"Lebanon\",\"last_name\":\"Ghantous\",\"address2\":null,\"company\":null,\"latitude\":null,\"longitude\":null,\"name\":\"Tatiana Ghantous\",\"country_code\":\"LB\",\"province_code\":null},\"customer\":{\"id\":6970289356931,\"email\":\"tatianaghantous2@gmail.com\",\"created_at\":\"2024-03-20T12:45:10+02:00\",\"updated_at\":\"2024-03-20T12:58:23+02:00\",\"first_name\":\"Tatiana\",\"last_name\":\"Ghantous\",\"state\":\"disabled\",\"note\":null,\"verified_email\":true,\"multipass_identifier\":null,\"tax_exempt\":false,\"phone\":null,\"email_marketing_consent\":{\"state\":\"not_subscribed\",\"opt_in_level\":\"single_opt_in\",\"consent_updated_at\":null},\"sms_marketing_consent\":null,\"tags\":\"\",\"currency\":\"USD\",\"tax_exemptions\":[],\"admin_graphql_api_id\":\"gid://shopify/Customer/6970289356931\",\"default_address\":{\"id\":8823274799235,\"customer_id\":6970289356931,\"first_name\":\"Tatiana\",\"last_name\":\"Ghantous\",\"company\":null,\"address1\":\"Roumiehb\",\"address2\":null,\"city\":\"Beirut\",\"province\":null,\"country\":\"Lebanon\",\"zip\":null,\"phone\":null,\"name\":\"Tatiana Ghantous\",\"province_code\":null,\"country_code\":\"LB\",\"country_name\":\"Lebanon\",\"default\":true}},\"discount_applications\":[],\"fulfillments\":[],\"line_items\":[{\"id\":13364643659907,\"admin_graphql_api_id\":\"gid://shopify/LineItem/13364643659907\",\"attributed_staffs\":[],\"current_quantity\":2,\"fulfillable_quantity\":2,\"fulfillment_service\":\"manual\",\"fulfillment_status\":null,\"gift_card\":false,\"grams\":200,\"name\":\"Mediastar Receiver - black / 32\",\"price\":\"45.69\",\"price_set\":{\"shop_money\":{\"amount\":\"45.69\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"45.69\",\"currency_code\":\"USD\"}},\"product_exists\":true,\"product_id\":8087641653379,\"properties\":[],\"quantity\":2,\"requires_shipping\":true,\"sku\":\"sdgdgfFF-1\",\"taxable\":true,\"title\":\"Mediastar Receiver\",\"total_discount\":\"0.00\",\"total_discount_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"variant_id\":43802780336259,\"variant_inventory_management\":\"shopify\",\"variant_title\":\"black / 32\",\"vendor\":\"Galaxy Sat\",\"tax_lines\":[{\"channel_liable\":false,\"price\":\"9.14\",\"price_set\":{\"shop_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"9.14\",\"currency_code\":\"USD\"}},\"rate\":0.1,\"title\":\"VAT\"}],\"duties\":[],\"discount_allocations\":[]}],\"payment_terms\":null,\"refunds\":[],\"shipping_address\":{\"first_name\":\"Tatiana\",\"address1\":\"Roumiehb\",\"phone\":null,\"city\":\"Beirut\",\"zip\":null,\"province\":null,\"country\":\"Lebanon\",\"last_name\":\"Ghantous\",\"address2\":null,\"company\":null,\"latitude\":33.8937913,\"longitude\":35.5017767,\"name\":\"Tatiana Ghantous\",\"country_code\":\"LB\",\"province_code\":null},\"shipping_lines\":[{\"id\":4418002485379,\"carrier_identifier\":\"650f1a14fa979ec5c74d063e968411d4\",\"code\":\"Standard\",\"discounted_price\":\"0.00\",\"discounted_price_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"phone\":null,\"price\":\"0.00\",\"price_set\":{\"shop_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"},\"presentment_money\":{\"amount\":\"0.00\",\"currency_code\":\"USD\"}},\"requested_fulfillment_service_id\":null,\"source\":\"shopify\",\"title\":\"Standard\",\"tax_lines\":[],\"discount_allocations\":[]}]}}";
            controller.ControllerContext = new ControllerContext
            {
                HttpContext = new DefaultHttpContext()
            };
            controller.Request.Headers.Add("X-Shopify-Hmac-Sha256", hmacSignature);
            controller.Request.Body = new MemoryStream(Encoding.UTF8.GetBytes(requestBodyyy));

            // Act
            var result = controller.HandlePostRequest();

            // Assert
            Assert.IsType<OkResult>(result);
        }
        private const string CLIENT_SECRET = "e6962cdcf571d0de35fe04de1f08acc07024de30abe7e63443f3fd1220c97d51";
        [Fact]
        public void VerifyWebhook_ValidVerification_ReturnsTrue()
        {
            // Arrange
            var context = new ClothingStoreContext();
            var webhookAuthenticationService = new WebhookAuthenticationService();
            var data = "example_data";
            byte[] keyBytes = Encoding.UTF8.GetBytes(CLIENT_SECRET);
            using (var hmac = new HMACSHA256(keyBytes))
            {
                byte[] hashBytes = hmac.ComputeHash(Encoding.UTF8.GetBytes(data));
                string hmacHeader = Convert.ToBase64String(hashBytes);

                // Act
                bool result = webhookAuthenticationService.VerifyWebhook(data, hmacHeader);

                // Assert
                Assert.True(result);
            }
        }
    }
}